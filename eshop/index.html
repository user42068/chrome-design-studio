<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mini E‚Äëshop (jedin√Ω soubor) ‚Äì SPA + fake backend</title>
  <meta name="description" content="Studijn√≠ e‚Äëshop postaven√Ω ƒçistƒõ na HTML, CSS a JavaScriptu v jedin√©m souboru. SPA s hash routerem, localStorage, katalog, detail, ko≈°√≠k, pokladna a admin objedn√°vky." />

  <!-- ===========================
       Z√ÅKLADN√ç STYLY (ƒçist√© CSS)
       - Responzivn√≠ layout (flex + grid)
       - Svƒõtl√Ω/temn√Ω kontrast, p≈ôehlednost
       - Bez extern√≠ch knihoven
       =========================== -->
  <style>
    :root{
      --bg: #0b0c10;
      --panel: #121319;
      --text: #e8ecf1;
      --muted: #a3adbb;
      --accent: #4f8cff;
      --accent-2: #00c2a8;
      --danger: #ff5678;
      --warning: #ffb020;
      --ok: #35d07f;
      --border: #1f2430;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 16px;
      --radius-sm: 10px;
    }
    *{box-sizing:border-box}
    html, body {height: 100%}
    body{
      margin:0; background:linear-gradient(180deg, #0b0c10 0%, #0f1220 100%);
      color:var(--text); font: 16px/1.5 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, "Helvetica Neue", Arial;
      letter-spacing:.2px;
    }
    a{color:inherit; text-decoration:none}
    img{max-width:100%; display:block}
    button, input, select, textarea { font: inherit; color: inherit }

    /* Kontejner str√°nky */
    .app{ max-width: 1200px; margin: 0 auto; padding: 16px; }

    /* Hlaviƒçka s navigac√≠ */
    header{
      position:sticky; top:0; z-index:10; backdrop-filter:saturate(140%) blur(8px);
      background:rgba(11,12,16,.6); border-bottom:1px solid var(--border);
    }
    .nav{
      display:flex; align-items:center; gap:12px; padding:12px 16px; flex-wrap:wrap;
    }
    .brand{ font-weight:800; letter-spacing:.4px; display:flex; align-items:center; gap:10px }
    .brand .dot{ width:10px; height:10px; border-radius:50%; background:linear-gradient(135deg, var(--accent), var(--accent-2)); box-shadow:0 0 20px rgba(79,140,255,.6) }
    .nav a{ padding:8px 12px; border:1px solid var(--border); border-radius:999px; opacity:.9 }
    .nav a.active{ background:linear-gradient(135deg, rgba(79,140,255,.2), rgba(0,194,168,.2)); border-color: transparent }
    .nav .spacer{ flex:1 }

    /* Panely/sekce */
    main{ display:grid; gap:20px; padding:20px 16px 40px }
    section{ background: radial-gradient(1200px 300px at top, rgba(255,255,255,.04), transparent 50%), var(--panel); border:1px solid var(--border); border-radius: var(--radius); box-shadow: var(--shadow) }
    section header{ position:unset; backdrop-filter:none; background:transparent; border-bottom:1px solid var(--border); border-radius: var(--radius) var(--radius) 0 0 }
    section .section-body{ padding:18px }

    .section-title{ display:flex; align-items:center; gap:10px; padding:14px 18px; }
    .section-title h2{ margin:0; font-size:20px }

    /* Katalog ‚Äì m≈ô√≠≈æka produkt≈Ø */
    .toolbar{ display:flex; gap:12px; flex-wrap:wrap; margin-bottom:12px }
    .search{ flex:1; min-width:240px; display:flex; gap:8px }
    .search input{ flex:1; padding:10px 12px; background:#0e1220; border:1px solid var(--border); border-radius: var(--radius-sm) }
    .search button{ padding:10px 12px; border:1px solid var(--border); background:#0f1426; border-radius: var(--radius-sm); cursor:pointer }

    .grid{ display:grid; grid-template-columns: repeat(4, 1fr); gap:16px }
    @media (max-width: 1000px){ .grid{ grid-template-columns: repeat(3, 1fr) } }
    @media (max-width: 720px){ .grid{ grid-template-columns: repeat(2, 1fr) } }
    @media (max-width: 480px){ .grid{ grid-template-columns: 1fr } }

    .card{ display:flex; flex-direction:column; gap:10px; background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,.01)); border:1px solid var(--border); border-radius: var(--radius); overflow:hidden }
    .card img{ aspect-ratio: 4/3; object-fit:cover; background:#0d101a }
    .card .pad{ padding:12px }
    .price{ font-weight:700; }
    .muted{ color:var(--muted) }

    .row{ display:flex; align-items:center; justify-content:space-between; gap:10px }
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:8px; padding:10px 12px; border-radius: 10px; border:1px solid var(--border); background:#0f1426; cursor:pointer }
    .btn.primary{ background:linear-gradient(135deg, rgba(79,140,255,.22), rgba(0,194,168,.22)); border-color:transparent }
    .btn.danger{ background:linear-gradient(135deg, rgba(255,86,120,.25), rgba(255,86,120,.15)); border-color:transparent }
    .btn:disabled{ opacity:.5; cursor:not-allowed }

    /* Detail */
    .detail-wrap{ display:grid; grid-template-columns: 1.2fr 1fr; gap:20px }
    @media (max-width: 900px){ .detail-wrap{ grid-template-columns: 1fr } }
    .bigimg{ border-radius: var(--radius); overflow:hidden; border:1px solid var(--border) }
    .qty{ display:inline-flex; align-items:center; gap:8px }
    .qty button{ width:32px; height:32px }
    .inline{ display:inline-flex; gap:10px; align-items:center; flex-wrap:wrap }

    /* Ko≈°√≠k */
    .cart-item{ display:grid; grid-template-columns: 80px 1fr auto; gap:12px; padding:10px 0; border-bottom:1px dashed var(--border) }
    .cart-item:last-child{ border-bottom:none }
    .totals{ display:grid; gap:8px; border-top:1px solid var(--border); padding-top:12px; max-width:420px }

    /* Formul√°≈ôe */
    form{ display:grid; gap:12px; max-width: 640px }
    label{ display:grid; gap:6px }
    input, textarea{ padding:10px 12px; background:#0e1220; border:1px solid var(--border); border-radius: var(--radius-sm) }
    .help{ font-size:.9em; color:var(--muted) }

    table{ width:100%; border-collapse:collapse }
    th, td{ padding:10px 12px; border-bottom:1px solid var(--border); text-align:left }
    th{ color:var(--muted); font-weight:600; }

    .hidden{ display:none !important }
    .badge{ background:var(--accent); color:#0b0c10; border-radius:999px; padding:2px 8px; font-weight:800 }
  </style>
</head>
<body>
  <!-- ===========================
       NAVIGACE A STATUS BAR
       - SPA ovl√°d√°n√≠ p≈ôes #hash
       - Zobrazen√≠ poƒçtu polo≈æek v ko≈°√≠ku
       =========================== -->
  <header>
    <div class="app nav">
      <div class="brand"><span class="dot"></span> Mini E‚Äëshop</div>
      <a href="#catalog" data-link>üõçÔ∏è Katalog</a>
      <a href="#cart" data-link>üß∫ Ko≈°√≠k <span id="navCartCount" class="badge">0</span></a>
      <a href="#checkout" data-link>üí≥ Pokladna</a>
      <a href="#admin" data-link>üõ†Ô∏è Admin</a>
      <span class="spacer"></span>
      <span class="muted" id="status"></span>
    </div>
  </header>

  <main class="app">

    <!-- ===========================
         SEKCE: KATALOG (#catalog)
         - Vyhled√°v√°n√≠ podle n√°zvu
         - Karty produkt≈Ø
         =========================== -->
    <section id="catalog" class="route">
      <div class="section-title"><h2>üõçÔ∏è Katalog</h2></div>
      <div class="section-body">
        <div class="toolbar">
          <div class="search">
            <input id="searchInput" type="search" placeholder="Hledat produkt podle n√°zvu‚Ä¶" />
            <button id="searchClear" class="btn" title="Vymazat">‚úñ</button>
          </div>
          <div class="muted">Poƒçet produkt≈Ø: <strong id="productCount">0</strong></div>
        </div>
        <div id="productGrid" class="grid"></div>
      </div>
    </section>

    <!-- ===========================
         SEKCE: DETAIL (#detail/:id)
         - Velk√Ω obr√°zek, popis, cena
         - P≈ôid√°n√≠ do ko≈°√≠ku / pr√°ce s polo≈ækou
         =========================== -->
    <section id="detail" class="route hidden">
      <div class="section-title"><h2>üîé Detail produktu</h2></div>
      <div class="section-body">
        <div id="detailBody" class="detail-wrap"></div>
      </div>
    </section>

    <!-- ===========================
         SEKCE: KO≈†√çK (#cart)
         - V√Ωpis polo≈æek, mno≈æstv√≠, maz√°n√≠
         - Mez souƒçet a celkem
         =========================== -->
    <section id="cart" class="route hidden">
      <div class="section-title"><h2>üß∫ Ko≈°√≠k</h2></div>
      <div class="section-body">
        <div id="cartList"></div>
        <div id="cartTotals" class="totals"></div>
        <div class="row" style="margin-top:12px">
          <a class="btn" href="#catalog">‚¨ÖÔ∏è Zpƒõt do katalogu</a>
          <a class="btn primary" href="#checkout">Pokraƒçovat k pokladnƒõ ‚û°Ô∏è</a>
        </div>
      </div>
    </section>

    <!-- ===========================
         SEKCE: POKLADNA (#checkout)
         - Formul√°≈ô s validac√≠
         - Ulo≈æen√≠ objedn√°vky + vypr√°zdnƒõn√≠ ko≈°√≠ku
         =========================== -->
    <section id="checkout" class="route hidden">
      <div class="section-title"><h2>üí≥ Pokladna</h2></div>
      <div class="section-body">
        <form id="checkoutForm">
          <label>Jm√©no a p≈ô√≠jmen√≠<input name="name" required placeholder="Jan Nov√°k" /></label>
          <label>E‚Äëmail<input name="email" required type="email" placeholder="jan.novak@example.cz" /></label>
          <label>Adresa<input name="address" required placeholder="Ulice 123" /></label>
          <label>Mƒõsto<input name="city" required placeholder="Praha" /></label>
          <label>PSƒå<input name="zip" required pattern="\\d{3}\\s?\\d{2}" placeholder="110 00" /></label>
          <div class="help">Po odesl√°n√≠ se objedn√°vka ulo≈æ√≠ do LocalStorage a ko≈°√≠k se vypr√°zdn√≠.</div>
          <div class="row">
            <a class="btn" href="#cart">‚¨ÖÔ∏è Zpƒõt do ko≈°√≠ku</a>
            <button class="btn primary" type="submit">Odeslat objedn√°vku</button>
          </div>
        </form>
      </div>
    </section>

    <!-- ===========================
         SEKCE: ADMIN (#admin)
         - Tabulka v≈°ech objedn√°vek z localStorage
         - Mo≈ænost mazat objedn√°vky
         =========================== -->
    <section id="admin" class="route hidden">
      <div class="section-title"><h2>üõ†Ô∏è Administrace objedn√°vek</h2></div>
      <div class="section-body">
        <div class="row" style="margin-bottom:10px">
          <button id="purgeAll" class="btn danger">Smazat V≈†ECHNY objedn√°vky</button>
          <span class="muted">Poƒçet objedn√°vek: <strong id="orderCount">0</strong></span>
        </div>
        <div style="overflow:auto">
          <table>
            <thead>
              <tr>
                <th>#</th>
                <th>ID</th>
                <th>Vytvo≈ôeno</th>
                <th>Z√°kazn√≠k</th>
                <th>E‚Äëmail</th>
                <th>Adresa</th>
                <th>Polo≈æky</th>
                <th>Celkem</th>
                <th>Akce</th>
              </tr>
            </thead>
            <tbody id="orderTableBody"></tbody>
          </table>
        </div>
      </div>
    </section>

  </main>

  <!-- ===========================
       LOGIKA A FAKE BACKEND (ƒçist√Ω JS)
       - Jednoduch√Ω hash router (SPA)
       - localStorage (cart, orders)
       - In‚Äëmemory produkty
       - Modul√°rn√≠ funkce s koment√°≈ôi
       =========================== -->
  <script>
    /* -----------------------------------------
     * Pomocn√© n√°stroje a "fake backend" datov√© struktury
     * ----------------------------------------- */
    const LS = {
      get(key, fallback){ try{ return JSON.parse(localStorage.getItem(key)) ?? fallback }catch{ return fallback } },
      set(key, value){ localStorage.setItem(key, JSON.stringify(value)) },
      remove(key){ localStorage.removeItem(key) }
    };

    // Form√°tov√°n√≠ CZK cen
    const CZK = new Intl.NumberFormat('cs-CZ', { style:'currency', currency:'CZK', maximumFractionDigits:0 });

    // "Datab√°ze" produkt≈Ø ‚Äì norm√°lnƒõ by p≈ôi≈°lo z API. Tady hard‚Äëcode pro studijn√≠ √∫ƒçely.
    const PRODUCTS = [
      { id:'p1', name:'Bezdr√°tov√° sluch√°tka AirVibe', price:1690, stock:20, color:'#4f8cff', desc:'Lehk√° bluetooth sluch√°tka s 30h v√Ωdr≈æ√≠ a ƒçist√Ωm zvukem.' },
      { id:'p2', name:'Mechanick√° kl√°vesnice KeyPro 87', price:2290, stock:12, color:'#00c2a8', desc:'TKL layout, hlin√≠kov√© ≈°asi, hot‚Äëswap sp√≠naƒçe a RGB.' },
      { id:'p3', name:'Chytr√© hodinky FitTime S', price:1990, stock:30, color:'#ffb020', desc:'Sp√°nek, kroky, GPS a notifikace. Vodƒõodolnost 5ATM.' },
      { id:'p4', name:'USB‚ÄëC nab√≠jeƒçka 65W GaN', price:790, stock:50, color:'#7c5cff', desc:'Kompaktn√≠ rychlonab√≠jeƒçka pro telefony i notebooky.' },
      { id:'p5', name:'Webkamera 1080p StreamCam', price:1290, stock:18, color:'#ff5678', desc:'Full HD obraz, du√°ln√≠ mikrofon a krytka soukrom√≠.' },
      { id:'p6', name:'Mini reproduktor BoomGo', price:890, stock:40, color:'#35d07f', desc:'Kapesn√≠, hlasit√Ω, s odolnost√≠ IPX7 a 12h bateri√≠.' }
    ];

    // Gener√°tor jednoduch√©ho SVG obr√°zku jako data URL (aby byl soubor 100% samostatn√Ω)
    function makeImageData(title, color){
      const svg = encodeURIComponent(`
        <svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 800 600'>
          <defs>
            <linearGradient id='g' x1='0' y1='0' x2='1' y2='1'>
              <stop offset='0%' stop-color='${color}'/>
              <stop offset='100%' stop-color='#101422'/>
            </linearGradient>
          </defs>
          <rect width='100%' height='100%' fill='url(#g)'/>
          <g fill='white' font-family='system-ui, sans-serif' text-anchor='middle'>
            <text x='400' y='310' font-size='48' font-weight='700'>${title}</text>
          </g>
        </svg>`);
      return `data:image/svg+xml;utf8,${svg}`;
    }

    // Inicializace/p≈ô√≠stup k localStorage ko≈°√≠k & objedn√°vky
    function getCart(){ return LS.get('cart', []) }
    function setCart(items){ LS.set('cart', items); renderCartBadge() }
    function getOrders(){ return LS.get('orders', []) }
    function setOrders(list){ LS.set('orders', list) }

    // Vyhled√°n√≠ produktu dle ID
    function findProduct(id){ return PRODUCTS.find(p => p.id === id) }

    // P≈ôid√°n√≠ do ko≈°√≠ku
    function addToCart(productId, qty=1){
      const cart = getCart();
      const item = cart.find(i => i.id === productId);
      if(item){ item.qty = Math.min(item.qty + qty, 99) }
      else { cart.push({ id: productId, qty: Math.max(1, qty) }) }
      setCart(cart);
      flashStatus('P≈ôid√°no do ko≈°√≠ku');
    }

    // Zmƒõna mno≈æstv√≠/maz√°n√≠
    function updateCart(productId, qty){
      let cart = getCart();
      const idx = cart.findIndex(i => i.id === productId);
      if(idx === -1) return;
      if(qty <= 0){ cart.splice(idx,1) }
      else { cart[idx].qty = Math.min(qty, 99) }
      setCart(cart);
    }

    // V√Ωpoƒçty celkov√© ceny ko≈°√≠ku
    function cartTotals(){
      const cart = getCart();
      let subtotal = 0; let items = 0;
      const detailed = cart.map(row => {
        const p = findProduct(row.id); const lineTotal = p.price * row.qty; items += row.qty; subtotal += lineTotal;
        return { ...row, product: p, lineTotal };
      });
      const shipping = subtotal > 2500 || subtotal === 0 ? 0 : 99;
      const total = subtotal + shipping;
      return { items, subtotal, shipping, total, detailed };
    }

    // Rychl√° status hl√°≈°ka vpravo naho≈ôe
    let statusTimer;
    function flashStatus(text){
      const el = document.getElementById('status');
      el.textContent = text; clearTimeout(statusTimer);
      statusTimer = setTimeout(() => el.textContent = '', 2000);
    }

    // Odznak s poƒçtem polo≈æek
    function renderCartBadge(){
      const count = getCart().reduce((a,b)=>a+b.qty,0);
      document.getElementById('navCartCount').textContent = count;
    }

    /* -----------------------------------------
     * Router (hash‚Äëbased): #catalog, #detail/:id, #cart, #checkout, #admin
     * ----------------------------------------- */
    const routes = ['catalog','detail','cart','checkout','admin'];
    function handleRoute(){
      const hash = location.hash.replace('#','') || 'catalog';
      const [route, param] = hash.split('/');
      // zviditelnit spr√°vnou sekci
      document.querySelectorAll('.route').forEach(s => s.classList.add('hidden'));
      const target = document.getElementById(route) || document.getElementById('catalog');
      target.classList.remove('hidden');
      // aktivn√≠ z√°lo≈æka
      document.querySelectorAll('[data-link]').forEach(a => a.classList.toggle('active', a.getAttribute('href') === `#${route}`));

      // logika pro konkr√©tn√≠ view
      if(route === 'catalog') renderCatalog();
      if(route === 'detail') renderDetail(param);
      if(route === 'cart') renderCart();
      if(route === 'checkout') {/* nic spec */}
      if(route === 'admin') renderAdmin();
    }
    window.addEventListener('hashchange', handleRoute);

    /* -----------------------------------------
     * Render: Katalog
     * ----------------------------------------- */
    function renderCatalog(){
      const q = (document.getElementById('searchInput').value || '').trim().toLowerCase();
      const items = PRODUCTS.filter(p => p.name.toLowerCase().includes(q));
      document.getElementById('productCount').textContent = items.length;
      const grid = document.getElementById('productGrid');
      grid.innerHTML = '';
      for(const p of items){
        const card = document.createElement('div');
        card.className = 'card';
        const img = document.createElement('img'); img.src = makeImageData(p.name, p.color); img.alt = p.name;
        const pad = document.createElement('div'); pad.className = 'pad';
        const name = document.createElement('div'); name.textContent = p.name;
        const row = document.createElement('div'); row.className = 'row';
        const price = document.createElement('div'); price.className = 'price'; price.textContent = CZK.format(p.price);
        const actions = document.createElement('div'); actions.className = 'inline';
        const btnDetail = document.createElement('a'); btnDetail.href = `#detail/${p.id}`; btnDetail.className='btn'; btnDetail.textContent = 'Detail';
        const btnAdd = document.createElement('button'); btnAdd.className='btn primary'; btnAdd.textContent = 'Do ko≈°√≠ku';
        btnAdd.addEventListener('click', ()=>{ addToCart(p.id, 1); renderCartBadge() });
        actions.append(btnDetail, btnAdd);
        row.append(price, actions);
        pad.append(name, row);
        card.append(img, pad);
        grid.append(card);
      }
    }

    // Ovl√°d√°n√≠ vyhled√°v√°n√≠
    document.getElementById('searchInput').addEventListener('input', renderCatalog);
    document.getElementById('searchClear').addEventListener('click', ()=>{ document.getElementById('searchInput').value=''; renderCatalog() });

    /* -----------------------------------------
     * Render: Detail produktu
     * ----------------------------------------- */
    function renderDetail(id){
      const container = document.getElementById('detailBody');
      const p = findProduct(id);
      if(!p){ container.innerHTML = '<p class="muted">Produkt nebyl nalezen.</p>'; return }
      const cartItem = getCart().find(i => i.id === p.id);
      const qty = cartItem?.qty ?? 0;

      container.innerHTML = `
        <div>
          <img class="bigimg" src="${makeImageData(p.name, p.color)}" alt="${p.name}" />
        </div>
        <div>
          <h3 style="margin:0 0 8px">${p.name}</h3>
          <div class="muted" style="margin-bottom:10px">Skladem: ${p.stock} ks</div>
          <p style="margin-top:0">${p.desc}</p>
          <div class="price" style="font-size:22px; margin: 10px 0;">${CZK.format(p.price)}</div>

          <div class="inline" style="margin:10px 0 16px">
            <div class="qty">
              <button class="btn" id="minus">‚àí</button>
              <input id="qty" type="number" min="1" max="99" value="${Math.max(qty,1)}" style="width:70px" />
              <button class="btn" id="plus">+</button>
            </div>
            <button id="addBtn" class="btn primary">${qty>0? 'Aktualizovat ko≈°√≠k' : 'P≈ôidat do ko≈°√≠ku'}</button>
            ${qty>0 ? '<button id="removeBtn" class="btn danger">Odebrat z ko≈°√≠ku</button>' : ''}
          </div>

          <div id="calc" class="muted"></div>
        </div>`;

      const qtyInput = document.getElementById('qty');
      const recalc = ()=>{ const n = clamp(parseInt(qtyInput.value)||1,1,99); qtyInput.value=n; document.getElementById('calc').innerHTML = `Cena za ${n} ks: <strong>${CZK.format(n*p.price)}</strong>` };
      recalc();
      document.getElementById('minus').onclick = ()=>{ qtyInput.value = Math.max(1, (parseInt(qtyInput.value)||1)-1); recalc() };
      document.getElementById('plus').onclick = ()=>{ qtyInput.value = Math.min(99, (parseInt(qtyInput.value)||1)+1); recalc() };
      document.getElementById('addBtn').onclick = ()=>{ updateCart(p.id, parseInt(qtyInput.value)||1); if(qty===0){ flashStatus('P≈ôid√°no do ko≈°√≠ku') } else { flashStatus('Ko≈°√≠k aktualizov√°n') } renderCartBadge() };
      const rm = document.getElementById('removeBtn');
      if(rm){ rm.onclick = ()=>{ updateCart(p.id, 0); renderCartBadge(); flashStatus('Polo≈æka odstranƒõna'); handleRoute() } }
    }

    function clamp(n,min,max){ return Math.max(min, Math.min(max, n)) }

    /* -----------------------------------------
     * Render: Ko≈°√≠k
     * ----------------------------------------- */
    function renderCart(){
      const list = document.getElementById('cartList');
      const totals = cartTotals();
      if(totals.detailed.length === 0){
        list.innerHTML = '<p class="muted">Ko≈°√≠k je pr√°zdn√Ω.</p>';
        document.getElementById('cartTotals').innerHTML = '';
        return;
      }
      list.innerHTML = '';
      for(const row of totals.detailed){
        const div = document.createElement('div'); div.className='cart-item';
        const img = document.createElement('img'); img.src = makeImageData(row.product.name, row.product.color); img.alt=row.product.name; img.style.borderRadius='10px';
        const meta = document.createElement('div');
        meta.innerHTML = `
          <div class="row">
            <a href="#detail/${row.product.id}"><strong>${row.product.name}</strong></a>
            <span class="price">${CZK.format(row.product.price)}</span>
          </div>
          <div class="inline" style="margin-top:6px">
            <div class="qty">
              <button class="btn" data-dec>‚àí</button>
              <input data-qty type="number" min="1" max="99" value="${row.qty}" style="width:70px" />
              <button class="btn" data-inc>+</button>
            </div>
            <button class="btn danger" data-remove>Odstranit</button>
          </div>`;
        const sum = document.createElement('div'); sum.innerHTML = `<div class="price">${CZK.format(row.lineTotal)}</div>`;
        div.append(img, meta, sum); list.append(div);

        // Handlery na ovl√°d√°n√≠ mno≈æstv√≠
        const qtyInput = meta.querySelector('[data-qty]');
        meta.querySelector('[data-inc]').onclick = ()=>{ qtyInput.value = clamp(parseInt(qtyInput.value)||1,1,98)+1; updateCart(row.product.id, parseInt(qtyInput.value)); renderCart() };
        meta.querySelector('[data-dec]').onclick = ()=>{ qtyInput.value = clamp(parseInt(qtyInput.value)||1,2,99)-1; updateCart(row.product.id, parseInt(qtyInput.value)); renderCart() };
        qtyInput.addEventListener('change', ()=>{ updateCart(row.product.id, parseInt(qtyInput.value)||1); renderCart() });
        meta.querySelector('[data-remove]').onclick = ()=>{ updateCart(row.product.id, 0); renderCart() };
      }

      document.getElementById('cartTotals').innerHTML = `
        <div class="row"><span>Mezisouƒçet</span><strong>${CZK.format(totals.subtotal)}</strong></div>
        <div class="row"><span>Doprava</span><strong>${totals.shipping===0? 'Zdarma' : CZK.format(totals.shipping)}</strong></div>
        <div class="row" style="font-size:18px"><span>Celkem</span><strong>${CZK.format(totals.total)}</strong></div>`;
    }

    /* -----------------------------------------
     * Checkout ‚Äì odesl√°n√≠ objedn√°vky
     * ----------------------------------------- */
    document.getElementById('checkoutForm').addEventListener('submit', (e)=>{
      e.preventDefault();
      const form = e.currentTarget;
      if(getCart().length === 0){ alert('Ko≈°√≠k je pr√°zdn√Ω.'); location.hash = '#catalog'; return }
      if(!form.reportValidity()) return;
      const data = Object.fromEntries(new FormData(form).entries());
      const totals = cartTotals();
      const order = {
        id: 'ord_' + Math.random().toString(36).slice(2,8),
        createdAt: new Date().toISOString(),
        customer: data,
        items: totals.detailed.map(d => ({ id:d.product.id, name:d.product.name, price:d.product.price, qty:d.qty, lineTotal:d.lineTotal })),
        summary: { items: totals.items, subtotal: totals.subtotal, shipping: totals.shipping, total: totals.total }
      };
      const list = getOrders(); list.unshift(order); setOrders(list);
      LS.remove('cart'); renderCartBadge();
      form.reset();
      alert('Dƒõkujeme! Objedn√°vka byla ulo≈æena a ko≈°√≠k vypr√°zdnƒõn.');
      location.hash = '#admin';
    });

    /* -----------------------------------------
     * Admin ‚Äì v√Ωpis a maz√°n√≠ objedn√°vek
     * ----------------------------------------- */
    function renderAdmin(){
      const tbody = document.getElementById('orderTableBody');
      const orders = getOrders();
      document.getElementById('orderCount').textContent = orders.length;
      tbody.innerHTML = '';
      orders.forEach((o, idx) => {
        const tr = document.createElement('tr');
        const itemsText = o.items.map(i => `${i.name} √ó ${i.qty}`).join(', ');
        tr.innerHTML = `
          <td>${idx+1}</td>
          <td><code>${o.id}</code></td>
          <td>${new Date(o.createdAt).toLocaleString('cs-CZ')}</td>
          <td>${o.customer.name}</td>
          <td>${o.customer.email}</td>
          <td>${o.customer.address}, ${o.customer.city} ${o.customer.zip}</td>
          <td>${itemsText}</td>
          <td><strong>${CZK.format(o.summary.total)}</strong></td>
          <td><button class="btn danger" data-del="${o.id}">Smazat</button></td>`;
        tbody.append(tr);
      });
      // Maz√°n√≠ objedn√°vky
      tbody.querySelectorAll('[data-del]').forEach(btn => btn.addEventListener('click', ()=>{
        const id = btn.getAttribute('data-del');
        const orders = getOrders().filter(o => o.id !== id); setOrders(orders); renderAdmin();
      }));
    }

    document.getElementById('purgeAll').addEventListener('click', ()=>{
      if(confirm('Opravdu smazat v≈°echny objedn√°vky?')){ LS.remove('orders'); renderAdmin() }
    });

    /* -----------------------------------------
     * Start aplikace
     * ----------------------------------------- */
    renderCartBadge();
    handleRoute();
  </script>
</body>
</html>
